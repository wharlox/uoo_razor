
sysmsg "deposit item recycler - start"
#@setvar! _this_script "Play Script: deposit-loadout\functions\deposit-item-recycler"

if not varexist _id_loop_recycler_lantern
    ## same var as-used in the SUPER ID-Recycler-looper
    setvar _id_loop_recycler_lantern  _deposit_loadout__lantern__trigger_recycle
endif

## recycle items IF and ONLY IF lantern is off - and MAYBE only if enable-var is set`
##   after ping-check (getlabel) [one per]
##     then magic-item-vault deposit items from reycle-container
##     then stockpile items from recycle-container
##     then shelf items from recycle-container
## then [light on or off] deposit all items (menu) into recycler
## then turn lantern on if it is off

## if cav lantern-serial is set and lantern is OFF - recycle items and close gump
if varexist _id_loop_recycler_lantern
    if @findtype! 2597 ground 2338 any 4 as _tmp
        ## if cav lantern is OFF then  ... recycle items
        ## 2594 is ID of light-on cav-lantern 2338 is hue
        ## 2597 is ID of light-off cav-lantern 2338 is hue
        if _tmp == _id_loop_recycler_lantern 
            #@setvar!  _whoami  name
            #if _whoami == _deposit_loadout__user_to_recycle
            if _deposit_loadout__recycle_with_current_user == 1
                overhead "inner"
                ## recycle items
                dclick _deposit_loadout__recycler
                waitforgump 4045111101
                gumpresponse 6 4045111101
                waitforgump 4045111101
                gumpresponse 6 4045111101
                @getlabel! _tmp _tmp_label
                gumpclose 4045111101
                @getlabel! _tmp _tmp_label
                ## magic item vault
                menu _deposit_loadout__magic_item_vault 0
                waitfortarget _deposit_loadout__magic_item_vault
                target _deposit_loadout__recycler
                @getlabel! _tmp _tmp_label
            endif
            ## stockpile add items from recycle-container
            menu _deposit_loadout__stockpile 0
            waitfortarget 500
            target _deposit_loadout__recycler
            @getlabel! _tmp _tmp_label
            ## shelf add items
            menu _deposit_loadout__shelf 0
            waitfortarget 500
            target _deposit_loadout__recycler
            waitforgump 3232825965
            gumpclose 3232825965
            @getlabel! _tmp _tmp_label
        endif
    endif
endif


## deposit ALL magic items
menu _deposit_loadout__recycler 0
#wait 200
@getlabel! _deposit_loadout__recycler _this
if "125 items" in _this
    overhead "item recycler is full" 38
endif
## deposit unid magic items
#menu _deposit_loadout__recycler 1
@getlabel! _deposit_loadout__recycler _this
#wait 600




## if cav lantern-serial is set and lantern is OFF - turn lantern on
if varexist _id_loop_recycler_lantern
    if @findtype! 2597 ground 2338 any 4 as _tmp
        ## if cav lantern is OFF then  ... recycle item
        ## 2594 is ID of light-on cav-lantern 2338 is hue
        ## 2597 is ID of light-off cav-lantern 2338 is hue
        if _tmp == _id_loop_recycler_lantern 
            dclick _id_loop_recycler_lantern
            @getlabel! _tmp _tmp_label
        endif
    endif
endif








sysmsg "deposit item recycler - complete"





#### continue script chain
hotkey "Play Script: deposit-loadout\functions\_util_continue_script_chain"
foreach _itr in _util_continue_script_chain 
    hotkey _itr
endfor
#if listexists _script_chain and list _script_chain > 0
#    poplist _script_chain front
#    foreach _a_script in _script_chain
#        hotkey _a_script
#    endfor
#endif