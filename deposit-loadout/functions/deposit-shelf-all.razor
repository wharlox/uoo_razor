
@setvar!  _this_shelf_serial  _deposit_loadout__shelf
@setvar  _max_time_for_deposit_shelf_loop_ms  20000


sysmsg "deposit shelf - start"
#@setvar! _this_script "Play Script: deposit-loadout\functions\deposit-shelf-all"

## deposit storage shelf
#clearsysmsg 
@setvar! _this_maybe_done 0
@settimer! _restock_timer 0
while timer _restock_timer <= _max_time_for_deposit_shelf_loop_ms
    menu _this_shelf_serial 0
    waitfortarget 500
    target self
    waitforgump 3232825965
    gumpclose 3232825965
    #@getlabel! backpack _tmp_label
    #wait 150
    @getlabel! _this_shelf_serial _tmp_label

    while 1 == 1
        if insysmsg "That container does not contain any items that may be added"
            if  _this_maybe_done  == 0
                ## sometimes script needs to deposit one-more-time
                ## alternative method is to check items and stones, if no decrease then break
                @setvar! _this_maybe_done  1
            else
                @settimer! _restock_timer _max_time_for_deposit_shelf_loop_ms
            endif
            break
        elseif insysmsg " were added"
            @setvar! _this_maybe_done 0
            break
        endif
        #wait 50
    endwhile

    #@getlabel! backpack _tmp_label
    #wait 200
endwhile
@removetimer! _restock_timer
##@getlabel! _this_shelf_serial _tmp_label
#overhead "all added to shelf"
wait 2000
sysmsg "deposit shelf - complete"





#### continue script chain
if listexists _script_chain and list _script_chain > 0
    poplist _script_chain front
    foreach _a_script in _script_chain
        hotkey _a_script
    endfor
endif