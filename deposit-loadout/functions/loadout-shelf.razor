
sysmsg "loadout shelf - start"
#@setvar! _this_script "Play Script: deposit-loadout\functions\loadout-shelf"

@setvar! _this_shelf_serial 0x4B41ED97
# @setvar! _this_shelf_serial_other 0x

## x 44-175  y 65 152
## top left: 44 65 0
## top right: 175 65 0
## bot left: 44 152 0
## bot right: 175 152 0

@setvar! _loadout_shelf_pouch_in_backpack__x 91
@setvar! _loadout_shelf_pouch_in_backpack__y 64

drop backpack 0 0 0

## shelf Resupply
menu _this_shelf_serial 1
@getlabel! _this_shelf_serial _tmp_label

if varexist _this_shelf_serial_other
    ## shelf Resupply
    menu _this_shelf_serial_other 1
    @getlabel! _this_shelf_serial_other _tmp_label
endif

@getlabel! _this_shelf_serial _tmp_label
@getlabel! _this_shelf_serial _tmp_label


if findtype "pouch" backpack  0 as _loot_pouch
    @getlabel! _loot_pouch _tmp_label
    overhead _tmp_label 
    setvar  _deposit_loadout_chain_loot_pouch  _loot_pouch
    # sysmsg "pouch"
    ## drop loot-pouch in packpack
    lift _loot_pouch

    # drop backpack 91 64 0
    drop backpack _loadout_shelf_pouch_in_backpack__x  _loadout_shelf_pouch_in_backpack__y  0
    @getlabel! backpack _tmp_label
    dclick _loot_pouch
    
    ## build a list of which represents number of spare trapped-pouches
    ## then all other trapped pouches will be placed on top of loot pouch
    @removelist! _trap_pouch_spares
    @createlist! _trap_pouch_spares
    @pushlist!  _trap_pouch_spares "1"
    @pushlist!  _trap_pouch_spares "2"
    @pushlist!  _trap_pouch_spares "3"
    @clearignore!
    while findtype "pouch" backpack 38 as _trap_pouch
        if list _trap_pouch_spares > 0
        foreach _tmp in _trap_pouch_spares
            # sysmsg _tmp
            if _tmp = "1"
                lift _trap_pouch
                drop _loot_pouch 94 152 0
            elseif _tmp = "2"
                lift _trap_pouch
                drop _loot_pouch 110 152 0
            elseif _tmp = "3"
                lift _trap_pouch
                drop _loot_pouch 102 152 0
            endif
            @getlabel! backpack _tmp_label
            #wait 200
            @ignore! _trap_pouch
            poplist _trap_pouch_spares front
            break
        endfor
        else
            ## drop trapped pouches in backpack over same pixel as loot-pouch
            lift _trap_pouch
            #drop backpack 91 64 0
            drop backpack _loadout_shelf_pouch_in_backpack__x _loadout_shelf_pouch_in_backpack__y 0
            @ignore! _trap_pouch
        endif
        @getlabel! backpack _tmp_label
        #wait 200
    endwhile
    @clearignore!
    

    ## potion satchel
    if findtype "alchemists satchel" backpack as _potion_satchel
        lift _potion_satchel 1
        drop _loot_pouch 64 64 0
        @getlabel! backpack _tmp_label
        #wait 100
        dclick _potion_satchel
    endif

    ## split band-aids
    ## split potions

endif
@getlabel! backpack _tmp_label

#wait 600
sysmsg "loadout shelf - complete"




#### continue script chain
if listexists _script_chain and list _script_chain > 0
    poplist _script_chain front
    foreach _a_script in _script_chain
        hotkey _a_script
    endfor
endif




stop
lift 0x4820D305 1
drop 0x4820D2FB -1 -1 0
lift 0x4820D2FB 1
drop 0x52F195BB 91 64 0
dclick 0x4820D2FB
lift 0x4820D302 1
drop 0x52F195BB 91 64 0
lift 0x4820D2FF 1
drop 0x52F195BB 91 64 0
lift 0x4820D301 1
drop 0x52F195BB 91 64 0
lift 0x4820D300 1
drop 0x52F195BB 91 64 0
dclick 0x4820D305

lift 0x48219E67 1
drop 0x48219E5E 64 64 0

lift 0x4828B2F6 1
drop 0x48219E5E 94 64 0
lift 0x4828B2F9 1
drop 0x48219E5E 110 64 0